### 목차
- [DNS란?](#DNS란)
- [DNS 동작 과정](#DNS_동작_과정)
- [DNS 서버의 종류](#DNS_서버의_종류)
- [전체적인 DNS 동작 원리](#전체적인_DNS_동작_원리)
# DNS란?
DNS(Domain Name System)란 도메인 이름 시스템으로, 사람이 읽을 수 있는 도메인 이름(예: www.amazon.com 을 기계가 읽을 수 있는 IP 주소(예: 192.0.2.44)로 변환하는 것을 의미한다.  
인터넷상의 모든 컴퓨터는 **IP 주소**를 사용해 서로를 찾고 통신한다.  
이런 IP 주소는 사람이 기억하기에는 너무 길고 어렵기 때문에 example.com 과 같은 도메인 이름을 이용해 웹 사이트를 찾아갈 수 있게 한다.  
인터넷의 DNS 시스템은 도메인 이름과 IP주소를 매핑시키는 역할을 한다.  
도메인 이름을 IP주소로 변환하는 요청을 전달하는데, 이 요청을 쿼리(query)라고 한다.

# DNS 동작 과정
end user(프로그램을 사용하는 일반 사용자)가 브라우저에서 도메인 네임을 검색하면, DNS서버로 도메인 이름이 전달된다.  
DNS 서버 내에서 전달받은 도메인 네임을 토대로 IP 주소를 찾아내 브라우저가 해당 IP 주소를 가진 호스팅 서버에 도달하도록 지시한다.  
그러면 브라우저가 해당 IP주소로 접속하고 end user가 웹사이트를 볼 수 있게 된다.  

![image](https://user-images.githubusercontent.com/70744494/166241326-a53ed745-2c09-47e5-beef-b2a0d6c9621f.png)
  
# DNS 서버의 종류

도메인의 총 관리는 ICANN 에서 하고, DNS 서버는 도메인 이름의 분류(최상위 도메인-개인 도메인-서브 도메인)와 마찬가지로 **디렉토리/계층 형태**로 구분된다. 
아래는 한국 DNS 서버들로 예를 들어 본 DNS 서버 구조이다.  

![image](https://user-images.githubusercontent.com/70744494/166243753-433434d1-3ee7-4afc-b690-4dcff0f6ae3b.png)  

- **Root DNS Server**: ICANN이 직접 관리하는 절대 존엄 서버로, TLD DNS 서버 IP들을 저장해두고 안내하는 역할을 한다.  
- **TLD(최상위 도메인) DNS Server**: 도메인 등록 기관(Registry)이 관리하는 서버로, Authoritative DNS 서버 주소를 저장해두고 안내하는 역할을 한다. 
어떤 도메인 묶음이 어떤 Authoritative DNS Server에 속하는지 아는 이유는 도메인 판매 업체(Registrar)의 DNS 설정이 변경되면 도메인 등록 기관(Registry)으로 전달이 되기 때문이다
- **Authoritative DNS Server**: 실제 개인 도메인과 IP 주소의 관계가 기록/저장/변경되는 서버이다. 그래서 권한의 의미인 Authoritative가 붙는다. 
일반적으로 도메인/호스팅 업체의 ‘네임서버’를 말하지만, 개인 DNS 서버 구축을 한 경우에도 여기에 해당한다.
- **Recursive DNS Server**: 인터넷 사용자가 가장 먼저 접근하는 DNS 서버이다. 
위 3개의 DNS 서버를 매번 거친다면 효율이 구데기일 수밖에 없으니, 한 번 거친 후 얻은 데이터를 일정 기간(TTL/Time to Live) 동안 캐시라는 형태로 저장해 두는 서버이다.
직접 도메인과 IP 주소의 관계를 기록/저장/변경하지는 않고 캐시만을 보관하기 때문에, Authoritative와 비교되는 의미로 반복의 Recursive가 붙는다. 
대표적인게 KT/LG/SK와 같은 ISP(통신사) DNS 서버가 있고, 브라우저 우회 용도로 많이 쓰는 구글 DNS, 클라우드플레어와 같은 Public DNS 서버가 있다.

여기서 중요 포인트는 **브라우저는 캐시가 저장된 Recursive 서버를 사용하고, 실제 네임서버를 설정하는 곳은 Authoritative 서버**라는 점이다.  

# 전체적인 DNS 동작 원리
  
![image](https://user-images.githubusercontent.com/70744494/166245967-7e495adc-bd66-4367-a782-b93c6a2a341d.png)
  
계층별로 DNS 서버 주소 따라가다 Authoritative DNS Server에서 정보를 얻는다.  
```
1. 브라우저에서 Nesite.com을 검색하고, 사용하고 있는 통신사인 KT DNS 서버에게 도메인 주소에 해당하는 IP 주소를 요청한다. (브라우저 기본 DNS 설정이 통신사 DNS 서버이기 때문)
2. ISP 서버에선 캐시 데이터가 없다는 걸 확인하고 루트 DNS 서버에게 어디로 가야 하는지 요청한다.(캐시가 있다면 8.로 건너뛴다.)
3. 루트 서버는 TLD DNS 서버 주소만 관리하기 때문에, ---.com 도메인을 보고는 COM 최상위 도메인을 관리하는 TLD DNS 서버 주소를 안내한다.
4. ISP 서버는 COM 서버에게 어디로 가야 하는지 다시 요청한다.
5. COM 서버는 가비아 DNS 서버에서 해당 도메인이 관리되고 있는 걸 확인하고 안내한다.
6. ISP 서버는 가비아 서버에게 또 다시 요청한다.
7. 가비아 서버는 “Nesite.com = 12.123.123.123”이라는 정보를 확인하고 이 IP를 알려준다. 동시에 ISP 서버는 해당 정보를 캐시로 기록해 둔다.
8. ISP 서버는 브라우저에게 힘들게 알아 낸 12.123.123.123 주소를 안내한다.
9. 브라우저는 12.123.123.123 IP 주소를 갖고 있는 호스팅 서버에게 웹사이트를 출력하라고 요청한다.
10. 드디어 보인다..
```

출처 : [DNS개념정리](https://gentlysallim.com/dns%EB%9E%80-%EB%AD%90%EA%B3%A0-%EB%84%A4%EC%9E%84%EC%84%9C%EB%B2%84%EB%9E%80-%EB%AD%94%EC%A7%80-%EA%B0%9C%EB%85%90%EC%A0%95%EB%A6%AC/)
